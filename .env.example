# ────────────────────────────────────────────────
# Voice Runtime Environment
# ────────────────────────────────────────────────
NODE_ENV=development
PORT=4001

# Transport mode: pstn (default) or webrtc_hd
TRANSPORT_MODE=pstn
WEBRTC_PORT=
WEBRTC_ALLOWED_ORIGINS=

# Audio diagnostics (off by default)
AUDIO_DIAGNOSTICS=false

# ────────────────────────────────────────────────
# Redis (RUNTIME REQUIRED)
# ────────────────────────────────────────────────
REDIS_URL=redis://localhost:6379

# ────────────────────────────────────────────────
# Redis Key Prefixes (CONTRACT-CRITICAL)
# ────────────────────────────────────────────────
TENANTMAP_PREFIX=tenantmap
TENANTCFG_PREFIX=tenantcfg
CAP_PREFIX=cap

# ────────────────────────────────────────────────
# Capacity Defaults (Runtime Safety Limits)
# ────────────────────────────────────────────────
GLOBAL_CONCURRENCY_CAP=30
TENANT_CONCURRENCY_CAP_DEFAULT=5
TENANT_CALLS_PER_MIN_CAP_DEFAULT=10
CAPACITY_TTL_SECONDS=120

# ────────────────────────────────────────────────
# Telnyx (Ingress + Media)
# ────────────────────────────────────────────────
TELNYX_API_KEY=replace-with-telnyx-api-key
PUBLIC_BASE_URL=https://your-runtime-public-url

# Signature enforcement
TELNYX_SKIP_SIGNATURE=true
# REQUIRE_TELNYX_SIGNATURE=true
TELNYX_STREAM_TRACK=inbound_track
TELNYX_STREAM_CODEC=
TELNYX_ACCEPT_CODECS=AMR-WB,G722,PCMU,PCMA
TELNYX_TARGET_SAMPLE_RATE=16000
TELNYX_STREAM_RESTART_MAX=1
TELNYX_INGEST_HEALTH_GRACE_MS=1200
TELNYX_INGEST_HEALTH_ENABLED=true
TELNYX_INGEST_HEALTH_RESTART_ENABLED=true
TELNYX_INGEST_POST_PLAYBACK_GRACE_MS=1200
TELNYX_INGEST_MIN_AUDIO_MS_SINCE_PLAYBACK_END=2000
TELNYX_AMRWB_MIN_DECODED_BYTES=320
TELNYX_INGEST_DECODE_FAILURES_BEFORE_FALLBACK=3
TELNYX_AMRWB_DECODE=1
TELNYX_G722_DECODE=0
TELNYX_OPUS_DECODE=0
TELNYX_MEDIA_STATS=false
MEDIA_DEBUG=false
TELNYX_DEBUG_MEDIA_SCHEMA=false
TELNYX_CAPTURE_ONCE=false
TELNYX_CAPTURE_CALL_ID=

# Telnyx media debug taps (raw frames + post-decode WAV)
TELNYX_DEBUG_TAP_RAW=false
TELNYX_DEBUG_TAP_POST_DECODE=false
STT_DEBUG_DIR=/tmp/veralux-stt-debug

# Warn on narrowband PSTN by default; enforce wideband only when needed (demos/client QA)
REQUIRE_WIDEBAND_PSTN=false

# STT chunk sizing (seconds)
STT_MIN_SECONDS=1.5
STT_SILENCE_MIN_SECONDS=1.0
STT_PARTIAL_MIN_MS=600
STT_RMS_FLOOR=0.015
STT_PEAK_FLOOR=0.05
STT_DISABLE_GATES=false
STT_DEBUG_LOWER_GATES=false
STT_DEBUG_LOG_RMS=false

# Tier 2: measured listen-after-playback grace (300–900ms based on last segment length)
# When unset, grace is computed dynamically. Set STT_POST_PLAYBACK_GRACE_MS for fixed override.
# STT_POST_PLAYBACK_GRACE_MS=650
STT_POST_PLAYBACK_GRACE_MIN_MS=300
STT_POST_PLAYBACK_GRACE_MAX_MS=900

# STT input DSP + debug
STT_HIGHPASS_ENABLED=true
STT_HIGHPASS_CUTOFF_HZ=100
STT_DEBUG_DUMP_WHISPER_WAVS=false
STT_DEBUG_DUMP_PCM16=false
STT_DEBUG_DUMP_RX_WAV=false
STT_DEBUG_DUMP_FAR_END_REF=false

# Tier 4: SpeexDSP AEC (requires: brew install speexdsp / apt install libspeexdsp-dev)
STT_AEC_ENABLED=false

# Tier 5: Auto-calibration (noise floor + adaptive thresholds)
# STT_NOISE_FLOOR_ENABLED=true
# STT_NOISE_FLOOR_ALPHA=0.05
# STT_NOISE_FLOOR_MIN_SAMPLES=30
# STT_ADAPTIVE_RMS_MULTIPLIER=2.0
# STT_ADAPTIVE_PEAK_MULTIPLIER=2.5
# STT_ADAPTIVE_FLOOR_MIN_RMS=0.01
# STT_ADAPTIVE_FLOOR_MIN_PEAK=0.03

# Tier 5: Late-final watchdog (force final if speech but no final in X sec)
# STT_LATE_FINAL_WATCHDOG_ENABLED=true
# STT_LATE_FINAL_WATCHDOG_MS=8000

# Dead air reprompt (frames-aware)
DEAD_AIR_NO_FRAMES_MS=1500

# ⚠️ Temporary only — long-term use tenantcfg secrets
TELNYX_WEBHOOK_SECRET=replace-or-remove
TELNYX_PUBLIC_KEY=replace-or-remove

# ────────────────────────────────────────────────
# Abuse / Cleanup (only if runtime reads these)
# ────────────────────────────────────────────────
CALL_TTL_MS=1800000
CALL_SWEEP_MS=60000

MSG_RATE_MAX=30
MSG_RATE_WINDOW_MS=60000
CALL_START_IP_RATE_MAX=60
